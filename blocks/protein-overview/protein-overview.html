<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../publication-item/publication-item.html">
<!--
`overview-section`
Top page section present on every viewer
@demo demo/index.html 
-->
<dom-module id="protein-overview">
  <template>
    <style>
      :host {
        display: block;
      }
      dd{
        margin-left:15px;
      }
      .grey-text {
        color: grey;
      }
      .text-right {
        text-align:right;
      }
      .paragraph {
        margin:10px 10px;
      }
      #extender {
        float:right;
        margin-top:-5px;
      }
    </style>
    <div id="proteinTitle">
      <button id="extender" class="btn btn-default">Extend overview</button>
      <h3>
        <template is="dom-if" if="{{data.geneName}}">
          <template is="dom-if" if="{{data.geneName.0.name}}">
            {{data.geneName.[0].name}}  â†’
          </template>
        </template>
        {{data.entryName}}
        <template is="dom-repeat" items="{{data.recommendedProteinName}}" as="rpn">
          <template is="dom-if" if="{{rpn.EC}}">[<template is="dom-repeat" items="{{rpn.EC}}" as="ec"> {{_linkToEc(ec)}} <span hidden$="[[!_checkIfLast(rpn.EC,index)]]">,</span> </template> ] </template>
          <template is="dom-if" if="{{rpn.mainShortName}}">( {{rpn.mainShortName}} ) </template>
        </template>
      </h3>
    </div>
    <div id="INFOS-LESS" style="display:block;margin-top:15px;">
      <template is="dom-if" if="{{data.recommendedProteinName.mainSynonymName}}">
        <div id="synonym-less" class="row">
          <div class="col-md-3 col-xs-3 grey-text text-right">Protein also known as :</div>
          <div class="col-md-9 col-xs-9">
            <template is="dom-repeat" items="{{data.recommendedProteinName}}" as="recommendedProteinName">
              <template is="dom-repeat" items="{{recommendedProteinName.mainSynonymName}}" as="mainSynonymName">{{mainSynonymName.name}}<template is="dom-if" if="{{mainSynonymName.synonym}}"> ({{mainSynonymName.synonym}}) </template></template>
              <template is="dom-if" if="{{data.recommendedProteinName.others}}"> ; </template>
              <template is="dom-repeat" items="{{recommendedProteinName.others}}" as="others">
                {{others.type}}{{_pluralize(others.names)}}:<template is="dom-repeat" items="{{others.names}}" as="nameArray"> {{nameArray.name}}<template is="dom-if" if="{{!_checkIfLast(others.names,index)}}">,</template></template>
                <template is="dom-if" if="{{!_checkIfLast(others,index)}}">; </template>
              </template>
            </template>
          </div>
        </div>
      </template>
      <template is="dom-if" if="{{!data.recommendedProteinName.mainSynonymName&&data.recommendedProteinName.others}}">
      <div id="synonym-other-less" class="row">
        <div class="col-md-3 col-xs-3 grey-text text-right">Protein also known as :</div>
        <div class="col-md-9 col-xs-9">
          <template is="dom-repeat" items="{{data.recommendedProteinName}}" as="recommendedProteinName">
            <template is="dom-repeat" items="{{recommendedProteinName.others}}" as="others">
              {{others.type}}{{_pluralize(others.names)}}:<template is="dom-repeat" items="{{others.names}}" as="nameArray">{{nameArray.name}}<template is="dom-if" if="{{!_checkIfLast(others.names,index)}}">,</template></template>
              <template is="dom-if" if="{{!_checkIfLast(others,index)}}">; </template>
            </template>
          </template>
        </div>
      </div>
      </template>
      <template is="dom-if" if="{{data.cleavage}}">
      <div id="cleavage-less" class="row">
        <div class="col-md-3 col-xs-3 grey-text text-right">Cleaved into :</div>
        <div class="col-md-6 col-xs-6">
          <template is="dom-repeat" items="{{data.cleavage}}" as="cleavage">
            <template is="dom-repeat" items="{{cleavage.names}}" as="nameArray"><span>{{nameArray.name}}<template is="dom-if" if="{{!_checkIfLast(cleavage.names,index)}}">; </template></span></template>
          </template>
        </div>
      </div>
      </template>
      <div id="gene-less" class="row">
        <template is="dom-if" if="{{data.geneName}}">
          <template is="dom-if" if="{{data.geneName.0.name}}">
            <div class="col-md-3 col-xs-3 grey-text text-right">Gene name :</div>
            <div class="col-md-6 col-xs-6" >
              <template is="dom-repeat" items="{{data.geneName}}" as="gn">{{gn.name}}<span hidden$="[[!_checkIfLast(geneName,index)]]">; </span></template></div>
          </template>
          <template is="dom-if" if="{{!data.geneName.0.name}}">
            <div class="col-md-3 col-xs-3 grey-text text-right">ORF name :</div>
            <div class="col-md-6 col-xs-6">{{data.geneName.0.orf.0.name}}</div>
          </template>
        </template>
        <template is="dom-if" if="{{!data.geneName}}">
          <div class="col-md-3 col-xs-3 grey-text text-right">Gene name :</div>
          <div class="col-md-6 col-xs-6" >None assigned yet</div>
        </template>
      </div>
      <template is="dom-if" if="{{data.families}}">
        <div id="family-less" class="row">
          <div class="col-md-3 col-xs-3 grey-text text-right">Family name :</div>
          <div class="col-md-6 col-xs-6">
            <template is="dom-repeat" items="{{data.families}" as="familyroot"><span>
              <template is="dom-repeat" items="{{familyroot.superfamily}" as="superfamily">{{_linkToTerm(superfamily)}}</template>
              <template is="dom-if" if="{{familyroot.family}}">
                <template is="dom-if" if="{{familyroot.superfamily}}"> >> </template>
                <template is="dom-repeat" items="{{familyroot.family}" as="family"> {{_linkToTerm(family)}} </template>
              </template>
              <template is="dom-if" if="{{familyroot.subfamily}}">
                <template is="dom-if" if="{{familyroot.family}}"> >> </template>
                <template is="dom-repeat" items="{{familyroot.subfamily}" as="subfamily">{{_linkToTerm(subfamily)}}</template>
              </template></span>
            </template>
          </div>
        </div>
      </template>
    </div>
    <div id="INFOS-FULL" style="display:none">
      <div id="protein-full" class="row">
        <div class="col-md-1 col-xs-2 text-uppercase grey-text">Protein</div>
        <div class="col-md-9 col-xs-8">
          <dl>
            <dt>Recommended name</dt>
            <template is="dom-repeat" items="{{data.recommendedProteinName}}" as="recommendedProteinName">
            <dd>{{recommendedProteinName.name}}
              <template is="dom-if" if="{{recommendedProteinName.EC}}">[
                <template is="dom-repeat" items="{{recommendedProteinName.EC}}" as="ec"> {{_linkToEc(ec)}} <template is="dom-if" if="{{!_checkIfLast(recommendedProteinName.EC,index)}}">,</template> </template> ] </template>
              <template is="dom-repeat" items="{{recommendedProteinName.synonyms}}" as="synonym">
                <template is="dom-if" if="{{synonym.short}}"><span><span  class="grey-text">Short: </span>
                  <template is="dom-repeat" items="{{synonyms.short}}" as="short">{{short}}<template is="dom-if" if="{{!_checkIfLast(synonym.short,index)}}">,</template></template></span></template>
              </template>
            </dd>
            </template>
            <template is="dom-if" if="{{data.alternativeProteinNames}}">
              <template is="dom-repeat" items="{{data.alternativeProteinName}}" as="alternativeProteinNames">
                <dt>{{alternativeProteinNames.type}}{{_pluralize(alternativeProteinNames.names)}}</dt>
                <template is="dom-repeat" items="{{alternativeProteinName.names}}" as="name">
                <dd> {{name.name}}
                  <template is="dom-repeat" items="{{name.synonyms}}" as="synonym">
                    <template is="dom-if" if="{{synonym.EC}}">[<template is="dom-repeat" items="{{synonyms.EC}}" as="ec"> {{_linkToEc(ec)}} <template is="dom-if" if="{{!_checkIfLast(synonym.EC,index)}}">,</template></template> ]</template>
                    <template is="dom-if" if="{{synonym.short}}"><span><span class="grey-text">Short: </span> <template is="dom-repeat" items="{{synonyms.short}}" as="short">{{short}}<template is="dom-if" if="{{!_checkIfLast(synonym.short,index)}}">,</template></template></span></template>
                  </template>
                </dd>
                </template>
              </template>
            </template>
            <template is="dom-if" if="{{data.functionalRegionNames}}">
              <template is="dom-repeat" items="{{data.functionalRegionNames}}" as="functionalRegionName">
              <dt>Include the following {{functionalRegionNames.names.length}} functional region{{_pluralize(functionalRegionNames.names)}}</dt>
                <template is="dom-repeat" items="{{functionalRegionName.names}}" as="regionName">
                  <dd> {{regionName.name}}
                    <template is="dom-repeat" items="{{regionName.synonyms}}" as="synonym">
                      <template is="dom-if" if="{{synonym.EC}}">[<template is="dom-repeat" items="{{synonyms.EC}}" as="ec"> {{_linkToEc(ec)}}
                        <template is="dom-if" if="{{!_checkIfLast(synonym.EC,index)}}">,</template>
                      </template> ]</template>
                      <template is="dom-repeat" items="{{synonyms.full}}" as="full">
                        <span><span class="grey-text">Alternative name{{_pluralize(full)}}:</span> <template is="dom-repeat" items="{{full}}" as="f">{{f}}
                          <template is="dom-if" if="{{!_checkIfLast(full.f,index)}}"> ; </template>
                        </template></span></template>
                    </template>
                  </dd>
                </template>
              </template>
            </template>
            <template is="dom-if" if="{{data.cleavage}}">
              <template is="dom-repeat" items="{{data.cleavage}}" as="cleavage">
                <dt>Cleaved into the following {{cleavage.names.length}} chain{{plural cleavage.names}}</dt>
                <template is="dom-repeat" items="{{cleavage.names}}" as="cleavageName">
                  <dd>{{cleavageName.name}}
                    <template is="dom-repeat" items="{{cleavage.synonyms}}" as="synonym">
                      <template is="dom-if" if="{{cleavage.EC}}">[<template is="dom-repeat" items="{{cleavage.EC}}" as="ec"> {{_linkToEc(ec)}}
                        <template is="dom-if" if="{{!_checkIfLast(cleavage.EC,index)}}">,</template> </template> ]
                      </template>
                      <template is="dom-if" if="{{cleavage.full}}">
                        <span><span class="grey-text">Alternative name{{plural cleavage.full}}:</span>
                        <template is="dom-repeat" items="{{cleavage.full}}" as="full">{{full}}
                          <template is="dom-if" if="{{!_checkIfLast(cleavage.full,index)}}"> ; </template>
                        </template></span>
                      </template>
                    </template>
                  </dd>
                </template>
              </template>
            </template>
            <template is="dom-if" if="{{data.isoforms}}">
              <dt>Spliced into the following {{isoforms.length}} isoform{{_pluralize(isoforms)}}</dt>
              <template is="dom-repeat" items="{{data.isoforms}}" as="isoform">
                <dd>{{isoform.name}}
                  <template is="dom-if" if="{{isoform.synonyms}}">
                    <span class="grey-text"> Alternative name{{_pluralize(isoform.synonyms)}}: </span>
                    <template is="dom-repeat" items="{{isoform.synonyms}}" as="synonym">{{synonym.name}}<template is="dom-if" if="{{!_checkIfLast(isoform.synonyms,index)}}"> ; </template></template>
                  </template></dd>
              </template>
            </template>
          </dl>
        </div>
      </div>
      <div id="gene-full" class="row">
        <div class="col-md-1 col-xs-2 text-uppercase grey-text">Gene</div>
        <div class="col-md-9 col-xs-8">
          <dl>
            <template is="dom-if" if="{{data.geneName}}">
              <template is="dom-repeat" items="{{geneName.geneName}}" as="geneName">
                <template is="dom-if" if="{{geneName.name}}">
                  <dt>Recommended name</dt>
                  <dd>{{geneName.name}}</dd>
                </template>
                <template is="dom-if" if="{{geneName.synonyms}}">
                  <dt>Alternative name{{_pluralize(geneName.synonyms)}}</dt>
                  <template is="dom-repeat" items="{{geneName.synonyms}}" as="synonym">
                    <dd> {{synonym.name}}</dd>
                  </template>
                </template>
                <template is="dom-if" if="{{geneName.orf}}">
                  <dt>ORF name{{_pluralize(geneName.orf)}}</dt>
                  <template is="dom-repeat" items="{{geneName.orf}}" as="orf">
                    <dd> {{orf.name}}</dd>
                  </template>
                </template>
                <template is="dom-if" if="{{!_checkIfLast(data.geneName,index)}}">
                  <br>
                </template>
              </template>
            </template>
            <template is="dom-if" if="{{!data.geneName}}">
              <dt>Recommended name</dt>
              <dd>None assigned yet</dd>
            </template>
          </dl>
        </div>
      </div>
      <template is="dom-if" if="{{data.families}}">
      <div id="family-full" class="row">
        <div class="col-md-1 col-xs-2 text-uppercase grey-text">Family</div>
        <div class="col-md-9 col-xs-8">
          <dl>
            <template is="dom-repeat" items="{{data.families}}" as="familyroot">
              <template is="dom-if" if="{{familyroot.superfamily}}">
                <template is="dom-repeat" items="{{familyroot.superfamily}}" as="superfamily">
                  <dt>Superfamily</dt>
                  <dd>{{{link_to "term"}}}</dd>
                </template>
              </template>
              <template is="dom-if" if="{{familyroot.family}}">
                <template is="dom-repeat" items="{{familyroot.family}}" as="family">
                  <dt>Family</dt>
                  <dd>{{_linkToTerm(family.accession, family.name)}}</dd>
                </template>
              </template>
              <template is="dom-if" if="{{familyroot.subfamily}}">
                <template is="dom-repeat" items="{{familyroot.subfamily}}" as="subfamily">
                  <dt>Subfamily</dt>
                  <dd>{{_linkToTerm(subfamily.accession, subfamily.name)}}</dd>
                </template>
              </template>
            </template>
          </dl>
        </div>
      </div>
      </template>
      <div id="History-full" class="row">
        <div class="col-md-1 col-xs-2 text-uppercase grey-text">History</div>
        <div class="col-md-9 col-xs-8">
          <dl>
            <dt>neXtProt</dt>
            <dd>Integrated {{data.integDate}}</dd>
            <dd>Last updated {{data.lastUpdate}}</dd>
            <dt>UniProtKB</dt>
            <dd>Integrated {{data.UniprotIntegDate}}</dd>
            <dd>Last updated {{data.UniprotLastUpdate}}</dd>
            <dd>Entry version {{data.version}}</dd>
            <template is="dom-if" if="{{data.lastSeqUpdate}}">
              <dd>Last sequence update {{data.lastSeqUpdate}}</dd>
            </template>
            <dd>Sequence version {{data.seqVersion}}</dd>
            <dd><template is="dom-if" if="{{data.accessionNumber}}">{{_linkToHistory(data.accessionNumber)}}</template></dd>
          </dl>
        </div>
      </div>
    </div>
    <p class="paragraph">{{data.proteineEvidence}}. {{data.proteineEvidenceCaution}}</p>
  </template>
  <script>
    Polymer({
      is: 'protein-overview',
      properties: {
        nxUrl: {
          type: String
        },
        data: {
          type: Object
        },
        _checkIfLast: function(array,index){
          if(array.length-1===index) return true;
          return false;
        },
        _linkToEc: function(ec){
          var url = this.nxUrl + "/term/" + ec;
          return "<a target='_blank' href='" + url + "'> EC " + ec + " </a>";
        },
        _linkToHistory: function(accession){
          var url = "http://www.uniprot.org/uniprot/" + accession.slice(3) + "?version=*";
          return "<a target='_blank' href='" + url + "'>Complete UniProtKB history</a>";
        },
        _linkToTerm: function(accession, name){
          var url = this.nxUrl + "/term/" + accession;
          return "<a target='_blank' href='" + url + "'>" + name + "</a>";
        },
        _pluralize: function(item){
          return item.length > 1 ? item+"s" : item;
        }
      }
    });
  </script>
</dom-module>
