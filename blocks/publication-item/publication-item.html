<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="stylesheet" type="text/css" href="../bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../font-awesome/css/font-awesome.min.css">
<!--
`publication-item`
Block element representing a publication record
@demo demo/index.html
-->
<dom-module id="publication-item">
  <template>
    <style>
      :host {
        display: block;
      }
      .publication-container {
        padding-left: 15px;
        margin-top: 5px;
        margin-bottom: 15px;
        border-left:1px solid darkgray;
      }
      .hyperlink-blue {
        color:#337ab7;
      }
      .external-link:after {
        content: "\f08e";
        font-family: "FontAwesome";
        font-size: 11px;
        margin-left: 5px;
        vertical-align: middle;
      }
      iron-collapse {
        margin-top: 5px;
      }
      button[pushed] .pubDisplayStatus:before {
         content:"Hide";
         display:inline-block;
         width:31px;
       }
      button .pubDisplayStatus:before {
        content:"Show";
      }
      #abstractHeader {
        color: #666;
        padding-bottom: 10px;
      }
    </style>
      <template is="dom-if" if="{{data}}">
        <template is="dom-if" if="{{data.title}}">
          <p><a href="/publication/{{data.publicationId}}"  target='_parent'>{{data.title}}</a></p>
        </template>
        <template is="dom-if" if="{{!summary}}">
          <p><span class="hyperlink-blue"><template is="dom-repeat" items="{{data.authors}}" as="author">{{author.lastName}} {{author.initials}}. , </template></span></p>
          <p>{{data.journal}} {{data.journalResourceLocator.medAbbrev}}, <strong>{{data.volume}}</strong>, {{data.firstPage}} <template is="dom-if" if="{{data.lastPage}}">- {{data.lastPage}}</template> ({{data.publicationYear}})
            <template is="dom-repeat" items="{{data.dbXrefs}}" as="xref">[{{_formatXrefLabel(xref.databaseName)}} : <a href="{{xref.resolvedUrl}}" class="external-link" target='_blank'>{{xref.accession}}</a>] </template></p>
        </template>
        <template is="dom-if" if="{{summary}}">
          {{data.authors.0.lastName}} {{data.authors.0.initials}}. <template is="dom-if" if="{{data.authors.1}}"><i>et al.</i></template>
          , {{data.journal}} {{data.journalResourceLocator.medAbbrev}}, <strong>{{data.volume}}</strong>, {{data.firstPage}} <template is="dom-if" if="{{data.lastPage}}">- {{data.lastPage}}</template> ({{data.publicationYear}})</template>
        </template>
        <template is="dom-if" if="{{data.abstractText}}">
          <button id="collapseButton" class="btn btn-primary btn-xs" type="button" on-tap="_toggleAbstract">
            <span class="pubDisplayStatus"> </span>abstract
          </button>
          <iron-collapse id="collapse{{data.publicationId}}" opened="{{showAbstract}}">
            <div id="abstractHeader" hidden>Abstract</div>
            {{data.abstractText}}
          </iron-collapse>
        </template>
        <template is="dom-if" if="{{!data.abstractText}}">
          No Abstract available
        </template>
      </template>
  </template>

  <script>
    Polymer({
      is: 'publication-item',
      properties: {
        data: {
          type: Object
        },
        showAbstract: {
          type: Boolean,
          value: false
        },
        summary: {
          type: Boolean,
          value: false
        }
      },
      attached: function () {
        if (this.showAbstract) {
          this.async(function(){
            this.$$("#abstractHeader").removeAttribute("hidden");
            this.$$("#collapseButton").remove();
          },1);
        }
      },
      _toggleAbstract: function(){
        this.$$("#collapse"+this.data.publicationId).toggle();
        this._toggleButton();
      },
      _toggleButton: function(){
        if (this.$$("#collapse"+this.data.publicationId).opened){
          this.$$("#collapseButton").setAttribute("pushed", null);
        } else {
          this.$$("#collapseButton").removeAttribute("pushed");
        }
      },
      _formatXrefLabel: function(name){
        return name.replace("DOI", "Full text");
      }
    });
  </script>
</dom-module>
